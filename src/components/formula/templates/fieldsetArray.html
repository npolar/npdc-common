<!DOCTYPE html>
<ul>
  <li ng-repeat="value in field.values" ng-if="!value.hidden">
    <md-whiteframe class="md-whiteframe-z2">
      <fieldset ng-class="{ valid: value.valid }">
        <legend>
          <span>{{ value.title }}</span>
          <span ng-if="!value.visible">{{ value.fields | formulaInlineValues }}</span>
          <div class="np-formula-object-ctrls">
            <div npdc:formula-field-info class="np-field-info" ng-init="field=value" ng-if="value.description"></div>
            <a class="toggle" href="" ng-click="field.itemToggle($index)" title="{{ value.visible ? form.i18n.minimize[1] : form.i18n.maximize[1] }}">
              <md-icon>{{ value.visible ? 'expand_less' : 'expand_more' }}</md-icon>
            </a>
            <md-menu>
              <md-button aria-label="Remove" class="md-icon-button remove" ng-click="$mdOpenMenu($event)">
                <md-icon md-menu-origin>close</md-icon>
              </md-button>
              <md-menu-content>
                <md-menu-item>
                  <md-button ng-click="field.itemRemove($index)" title="{{ form.i18n.remove[1] }}" class="md-warn">
                    <md-icon md-menu-align-target>delete</md-icon> Remove item
                  </md-button>
                </md-menu-item>
              </md-menu-content>
            </md-menu>
          </div>
        </legend>
        <formula:field-instance field="value" ng-show="value.visible" class="np-formula-subarray" />
      </fieldset>
    </md-whiteframe>
  </li>
</ul>
<div class="np-formula-array-add">
  <md-button ng-click="field.itemAdd()" class="md-fab md-mini md-primary md-hue-1" aria-label="{{ form.i18n.add[1] }}">
    <md-icon>add</md-icon>
  </md-button>
</div>
