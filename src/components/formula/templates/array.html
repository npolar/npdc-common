<fieldset ng-class="{ valid: field.valid, error: field.error }">
  <md-whiteframe class="md-whiteframe-z2">

    <legend>
      <div>{{ field.title }} ({{ field.nrArrayValues() }})</div>
      <div npdc:formula-field-info class="np-field-info" ng-if="::field.description"></div>
    </legend>

    <ul ng-if="::field.typeOf('field')">
      <li ng-repeat="value in field.values track by value.path" ng-class="{ valid: field.valid, error: field.error }">
        <formula:field field="value" class="multi-ctrls"></formula:field>
        <md-menu class="np-formula-input-ctrls remove">
          <md-button aria-label="Remove" class="md-icon-button remove" ng-click="$mdOpenMenu($event)">
            <md-icon md-menu-origin>close</md-icon>
          </md-button>
          <md-menu-content>
            <md-menu-item>
              <md-button ng-click="field.itemRemove($index)" title="{{ form.i18n.text.remove.tooltip }}" class="md-warn">
                <md-icon md-menu-align-target>delete</md-icon> Remove item
              </md-button>
            </md-menu-item>
          </md-menu-content>
        </md-menu>
      </li>
    </ul>


    <ul ng-if="::field.typeOf('fieldset')">
      <li ng-repeat="value in field.values track by value.path">
        <md-whiteframe class="md-whiteframe-z2">
          <fieldset ng-class="{ valid: value.valid }">
            <legend>
              <!--span class="np-formula-array-object-title">{{ value.title }}</span-->
              <span ng-if="!value.visible">{{ value.fields | formulaInlineValues }}</span>
              <div class="np-formula-object-ctrls">
                <div npdc:formula-field-info class="np-field-info" ng-if="value.description"></div>
                <a class="toggle" href="" ng-click="value.itemToggle($index)" title="{{ value.visible ? form.i18n.text.minimize.tooltip : form.i18n.text.maximize.tooltip }}">
                  <md-icon>{{ value.visible ? 'expand_less' : 'expand_more' }}</md-icon>
                </a>
                <md-menu>
                  <md-button aria-label="Remove" class="md-icon-button remove" ng-click="$mdOpenMenu($event)">
                    <md-icon md-menu-origin>close</md-icon>
                  </md-button>
                  <md-menu-content>
                    <md-menu-item>
                      <md-button ng-click="field.itemRemove($index)" title="{{ form.i18n.text.remove.tooltip }}" class="md-warn">
                        <md-icon md-menu-align-target>delete</md-icon> Remove item
                      </md-button>
                    </md-menu-item>
                  </md-menu-content>
                </md-menu>
              </div>
            </legend>
            <formula:field field="value" ng-if="value.visible" class="np-formula-array-fieldset"></formula:field>
          </fieldset>
        </md-whiteframe>
      </li>
    </ul>

    <div class="np-formula-array-add">
      <md-button ng-click="field.itemAdd()" class="md-fab md-mini md-primary md-hue-1" aria-label="{{ form.i18n.text.add.tooltip }}">
        <md-icon>add</md-icon>
      </md-button>
    </div>
    <div style="clear: both;"></div>
  </md-whiteframe>
</fieldset>
