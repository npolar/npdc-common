<!DOCTYPE html>
<!-- <form class="np-expand-search" action="." method="get" ng-submit="this.form.submit()">
  <input type="search" incremental="" results="10" name="q" value="{{q}}">
</form> -->
<div class="np-expand-search" ng-keyup="keyup($event);" ng-class="{ open: isOpen, sm: $mdMedia('sm'), md: $mdMedia('md'), lg: $mdMedia('lg')}">
  <md-fab-toolbar md-theme="white" md-open="isOpen" md-direction="left">
    <md-fab-trigger>
      <md-button aria-label="search" class="md-fab md-mini" ng-focus-out="blockEvent($event);" ng-click="open($event);">
        <span ng-show="filterCount > 0" class="np-filter-icon">{{filterCount}}</span>
        <md-icon>search</md-icon>
      </md-button>
    </md-fab-trigger>
    <md-toolbar ng-focus-out="blockEvent($event);" ng-click="blockEvent($event);">
      <md-fab-actions class="md-toolbar-tools">
        <div class="np-es-input" ng-class="{open : isFiltersOpen}" layout>
          <div flex layout>
            <md-icon class="es-search-icon">search</md-icon>
            <npdc:autocomplete ng-if="options.autocomplete" flex options="options.autocomplete"></npdc:autocomplete>
            <md-input-container ng-if="!options.autocomplete" flex>
             <label>{{placeholder}}</label>
             <input type="text" ng-model="query.q">
           </md-input-container>
          </div>
          <md-button ng-click="toggleFilters();">
            <md-icon>{{isFiltersOpen ? 'expand_less' : 'expand_more'}}</md-icon> Filters
            <span ng-show="filterCount > 0" class="np-filter-icon">{{filterCount}}</span>
          </md-button>
          <md-button ng-click="search();">
            Search
          </md-button>
        </div>
      </md-fab-actions>
    </md-toolbar>
  </md-fab-toolbar>
  <div ng-show="isFiltersOpen && isOpen" class="np-es-filter" ng-class="{ open: isFiltersOpen && isOpen }">
    <npdc:faceting ng-if="options.facets" options="options"></npdc:faceting>
    <div ng-if="options.autocomplete && options.autocomplete.showCollections" layout layout-wrap layout-align="space-between center">
      <md-checkbox flex="25" ng-change="updateAutocompleteCollection(options.q)" ng-model="options.autocomplete.collections[collection]" ng-repeat="(collection, value) in options.autocomplete.collections">{{ collection }}</md-checkbox>
    </div>
  </div>
</div>

<div id="np-es-click-area" ng-class="{ open: isOpen }" ng-click="close();"></div>
